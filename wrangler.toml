name = "wedding-gallery"
main = "worker.js"
compatibility_date = "2026-01-01"
compatibility_flags = ["nodejs_compat"]

workers_dev = true
preview_urls = true

# Routes (for Cloudflare Pages integration)
# If deploying as a Worker, you can also use routes here
routes = [
  { pattern = "wedding-gallery.zaidhuda.com/admin/*", zone_name = "zaidhuda.com" },
  { pattern = "wedding-gallery.zaidhuda.com/api/*", zone_name = "zaidhuda.com" },
  { pattern = "guestbook.zaidhuda.com/api/*", zone_name = "zaidhuda.com" },
  { pattern = "guestbook.zaidhuda.com/admin/*", zone_name = "zaidhuda.com" },
]

# Environment variables (optional)
[vars]
ENVIRONMENT = "production"
PHOTO_BASE_URL = "https://photos.wedding-gallery.zaidhuda.com"
MAX_PHOTO_SIZE = 12
TEXT_SYSTEM_PROMPT = """You moderate a Malay wedding LIVE digital guestbook. Decide if text is safe to display publicly.

Allow: praise, congratulations, playful slang, mild swearing used as intensifier, casual jokes, emojis.
Block: insults that attack dignity, humiliation, sexual content, hate/racism/religion slurs, threats, obscene gestures, animal insults.

Rules:
- SAFE if message is clearly positive/celebratory OR a compliment (including about a person).
  Examples SAFE: "Cantik gila Aina", "Handsome gila pengantin", "Sedap sial makanan", "Tahniah setan ðŸŽ‰".
- UNSAFE if any of these:
  1) Negative appearance/body/face/skin/weight remarks (buruk, hodoh, gemuk, hitam, etc) about a person.
  2) Animal comparisons aimed at a person (babi/anjing, "macam babi", etc).
  3) Insults where the insult is the main point (no clear celebration).
  4) Sexual remarks or sexualised body comments (even as a joke).
  5) Hate/extremism (race/religion slurs).
  6) Deliberate humiliation/embarrassment likely to upset couple/families later.
- UNSURE if cannot confidently classify as safe or unsafe.

Respond ONLY with valid JSON:
{"result":"safe"|"unsafe"|"unsure","reason":"[very_short_reason_without_description]"}.
No other text."""
IMAGE_SYSTEM_PROMPT = """You are a moderator for a Malay Wedding LIVE Digital Guestbook.
Decide if this image is safe to display publicly.

CULTURAL CONTEXT (do NOT mark unsafe for these):
- Ceremonial Keris worn at the waist (traditional attire), not a threat.
- Inai/henna patterns on hands/fingers, not blood or injury.
- Normal wedding affection: salam/hand-kissing, light hugs, forehead kisses.
- Traditional formal attire: kebaya, baju melayu, songket, sheer headscarves.

SAFE examples:
- Group photos, selfies, food/buffet, pelamin, decorations, families, children.

UNSAFE if ANY apply:
- Nudity or visible genitalia.
- Sexual acts or sexualised posing/touching (even if clothed).
- Real violence, fights, blood/injuries/gore (excluding henna).
- Obscene gestures (middle finger).
- Hate symbols or extremist imagery.
- JUNK CONTENT: The image is completely blank, solid color, pure noise, extremely blurry to the point of being unrecognizable, or clearly not a photo (e.g., just a single dot or meaningless scribble). If it's a photo but just bad quality, it's SAFE, but if it's "not a real image", it's UNSAFE.

UNSURE if cannot confidently classify as safe or unsafe.

Respond ONLY with valid JSON:
{"result":"safe"|"unsafe"|"unsure","reason":"[very_short_reason_without_description]"}.
No other text."""

[env.development.vars]
ENVIRONMENT = "development"
PHOTO_BASE_URL = "http://localhost:8787/images"

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "muna-li-zaid-gallery-db"
database_id = "899716a4-be80-4654-9ecf-a01e5ec192f5"

# R2 Bucket binding
[[r2_buckets]]
binding = "PHOTOS_BUCKET"
bucket_name = "muna-li-zaid-photos"

# Workers AI binding for content moderation
[ai]
binding = "AI"

[observability]
[observability.logs]
enabled = true
invocation_logs = true
